!function(a){if("undefined"!=typeof bu&&"undefined"!=typeof bu.plugins.navigation&&"undefined"!=typeof bu.plugins.navigation.tree){var b=bu.plugins.navigation;b.trees.buse_perm_editor=function(c,d){d=d||{};var e=b.trees.base(c,d),f=e.data,g=a.extend(e.config,c||{}),h=e.$el,i=a.inArray("crrm",f.treeConfig.plugins);i>-1&&(f.treeConfig.plugins.splice(i,1),"undefined"!=typeof f.treeConfig.crrm&&delete f.treeConfig.crrm);var j=a.inArray("dnd",f.treeConfig.plugins);j>-1&&(f.treeConfig.plugins.splice(j,1),"undefined"!=typeof f.treeConfig.dnd&&delete f.treeConfig.dnd),f.treeConfig.types={types:{"default":{},denied:{},"denied-desc-allowed":{},"denied-desc-unknown":{},allowed:{},"allowed-desc-denied":{},"allowed-desc-unknown":{}}},f.treeConfig.ui={select_limit:1},f.treeConfig.json_data.ajax={url:g.rpcUrl,type:"GET",cache:!1,data:function(a){return{group_id:g.groupID,node_prefix:g.nodePrefix,post_type:g.postType,query:{child_of:a.attr?d.stripNodePrefix(a.attr("id")):0}}},success:function(a){return a.posts},error:function(){}},f.treeConfig.json_data.progressive_render=!1;var k=function(b){b=b&&-1!=b?a.jstree._reference(h)._get_node(b):h.find("> ul > li");var c,d,e,f;b.each(function(){c=a(this),c.find("li").andSelf().each(function(){e=a(this).data("editable")?"denied":"allowed",f="allowed"==e?g.allowLabel:g.denyLabel,d=a('<button class="edit-perms '+e+'"></button>').text(f),a(this).children("a").not(":has(.edit-perms)").append(d)})})};return h.bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree",function(a,b){k(b.rslt.obj)}),h.bind("loaded.jstree",function(){k()}),h.addClass("buse-perm-editor"),e}}}(jQuery);